# 精粹



## Burpsuite





## Cobaltstrike

**简介**

cobalt strike(简称CS)是一款团队作战渗透测试神器,分为客户端及服务端,一个服务端可以对应
多个客户端,一个客户端可以连接多个服务端。

Cobalt Strike集成了端口转发、扫描多模式端口Listener、Windows exe程序生成、Windows dll动态
链接库生成、java程序生成、office宏代码生成,包括站点克隆获取浏览器的相关信息等。

**目录结构**

agscript  拓展应用的脚本
c2lint  用于检查profile的错误异常
teamserver  服务端程序
cobaltstrike, cobaltstrike.jar  客户端程序(java跨平台)
logs  目录记录与目标主机的相关信息
update, update.jar  用于更新CS
third-party  第三方工具



## Metaspoit

### 简介

**MSF**

The Metasploit Framework的简称。MSF高度模块化,即框架由多个
module组成,是全球最受欢迎的工具。

是一款开源安全漏洞利用和测试工具,集成了各种平台上常见的溢出漏洞
和流行的shellcode,并持续保持更新。

metasploit涵盖了渗透测试中全过程,你可以在这个框架下利用现有的
Payload进行一系列的渗透测试。

### 目录

data: 包含metasploit用于存储某些漏洞、单词列表、图像等所需二进制文件的可编辑文件。
documentation: 包含框架的可用文档。
lib: metasploit的库文件夹。
plugins: 用来存放metasploit的插件。
scripts: 用来存放metasploit的脚本,包括meterpreter及其它脚本。
tools: 存放多种的命令行实用程序。
modules: 存储metasploit的模块文件。

#### modules目录

auxiliary: 辅助模块, 辅助渗透 (端口扫描、登录密码爆破、漏洞验证等)

exploits: 漏洞利用模块, 包含主流的漏洞利用脚本, 通常是对某些可能存在漏洞的目标进行漏洞利用。命名规则: 操作系统/各种应用协议分类

payloads: 攻击载荷, 主要是攻击成功后在目标机器执行的代码, 比如反弹shell的代码

post: 后渗透阶段模块, 漏洞利用成功获得meterpreter之后, 向目标发送的一些功能性指令, 如: 提权等

encoders: 编码器模块, 主要包含各种编码工具, 对payload进行编码加密, 以便绕过入侵检测和过滤系统

evasion: 躲避模块, 用来生成免杀payload

nops: 由于IDS/IPS会检查数据包中不规则的数据, 在某些情况下, 比如针对溢出攻击, 某些特殊滑行字符串 (NOPS x90x90...) 则会因为被拦截而导致攻击失效。

### 常用命令

show exploits – 查看所有可用的渗透攻击程序代码
show auxiliary – 查看所有可用的辅助攻击工具
[show]options/advanced – 查看该模块可用选项
show payloads – 查看该模块适用的所有载荷代码
show targets - 查看该模块适用的攻击目标类型
search - 根据关键字搜索某模块
info – 显示某模块的详细信息
use - 使用某渗透攻击模块
back - 回退
set/unset - 设置/禁用模块中的某个参数
setg/unsetg - 设置/禁用适用于所有模块的全局参数
save - 将当前设置值保存下来,以便下次启动MSF终端时仍可使用

### meterpreter

meterpreter > background 放回后台
meterpreter > exit 关闭会话
meterpreter > help 帮助信息
meterpreter > sysinfo系统平台信息
meterpreter > screenshot 屏幕截取
meterpreter > shell 命令行shell (exit退出)
meterpreter > getlwd 查看本地目录
meterpreter > Icd 切换本地目录
meterpreter > getwd 查看目录
meterpreter > Is 查看文件目录列表
meterpreter > cd 切换目录
meterpreter > rm 删除文件

meterpreter > download C:\\1.txt 1.txt 下载文件
meterpreter > upload /var/www/wce.exe wce.exe 上传文件
meterpreter > search -d c: -f*.doc 搜索文件
meterpreter > execute -f cmd.exe -i 执行程序/命令
meterpreter > ps 查看进程
meterpreter > getuid 查看当前用户权限
meterpreter > run killav 关闭杀毒软件
meterpreter > run getgui-e 启用远程桌面
meterpreter > portfwd add -I 1234 -p 3389 -r <目标IP> 端口转发

### msfvenom

msfvenom是msfpayload和msfencode的组合。将这两个工具集成在一个框架实例中，
msfvenom是用来生成后门的软件，在目标机上执行后门，在本地监听上线

说白了就是生成木马的。将木马上传到靶机上并执行，拿到meterpreter





# 扫描



## Netdiscover

### 简介

Netdiscover是一种网络扫描工具，通过ARP扫描发现活动主机,可以通过主动和被动两种模式进行ARP扫描。通过主动发送ARP请求检查网络ARP流量，通过自动扫描模式扫描网络地,这种扫描的方式在内网中不容易被别人发现

```bash
sudo netdiscover -r 192.168.10.0/24
```



## Nmap

### 简介

在Kali中可以使用NMAP工具进行扫描，Nmap是不少黑客及脚本小子爱用的工具，可以检测目标主机是否在线、端口开放情况、侦测运行的服务类型及版本信息、侦测操作系统与设备类型等信息。

```bash
# -O 系统 -sV 版本
sudo nmap -O -sV 192.168.10.101
```



# 抓包

## Tcpdump



## Wireshark

Wireshark是一款可以抓取网卡数据包的软件



# 破解



## Aircrack-ng

### 安装

```zsh
yay -S aircrack-ng
```



## Crunch

Crunch可以按照指定的规则生成字典



https://github.com/k8gege/PasswordDic



## Hashcat
wordlists
工具：字典
任意用户枚举
用户口令破解
弱口令



```zsh
# 安装john
pacman -S john

# zip
zip2john file.zip > zip_hash.txt

# rar
rar2john file.rar > rar_hash.txt

# 7z
7z2john file.7z > 7z_hash.txt

```



## Hydra

### 简介

Hydra是一款开源的暴力破解工具,支持FTP、MSSQL、MySQL、PoP3、SSH等几乎所有协议的暴力破解



**暴力破解**

指用枚举的方式来爆破用户信息。具体的流程是用事先收集好的数据集成一个字典,然后用字典不断进行枚举,直到枚举成功,密码能否破解的关键在于字典是否强大



**应用场景**

验证码
不含验证码后台
各种应用程序:phpmyadmin,tomcat,mysql
各种协议:ftp,ssh,rdp
爆破大马



**协议**

一台终端不管是连接一个网站还是连接另一个终端,一切数据传输都需要按照相应的协议(特定的数据加工格式),而连接不同的主机需要用到的协议是不一样的

比如说:访问网站(HTTP),另一台主机(SSH)



### 参数介绍

hydra –l root –p root 172.26.2.36 ssh
-l 指定用户名
-L 指定用户名字典
-p 指定密码
-P 指定密码字典
-C 使用冒号分隔,比如root:root
-M 指定目标列表文件
-f 在找到第一对登录名或密码的时候停止



### 使用

```zsh
# 查看帮助
hydra -h

# 使用代理:为了避免留下真实IP,采用代理服务器的方式
# 真实多台主机攻击一台主机,IP地址更换,需要加代理

# 参数介绍
-R 继续从上一次进度接着破解。
-S 指定爆破时使用SSL连接
-s PORT 可通过这个参数指定非默认端口。例如：某些http服务使用非80端口
-l LOGIN 指定破解的用户，对特定用户破解。root
-L FILE 指定用户名字典。参数值为存储用户名的文件的路径（建议为绝对路径）用户字典
-p PASS 小写，指定密码破解，用的少，一般是采用密码字典。
-P FILE 大写，指定密码字典。参数值为存贮密码的文件(通常称为字典)的路径（建议为绝对路径）密码字典
-e ns 可选选项，n：空密码试探，s：使用指定用户和密码试探。
-C FILE 使用冒号分割格式，例如“登录名：密码”来代替-L/-P参数。
-M FILE 指定目标列表文件一行一条。也就是指定多个攻击目标，此参数为存储攻击目标的文件的路径(建议为绝对路径)。注意：列表文件存储格式必须为"地址：端口"
-O FILE 指定结果输出文件。
-f 在使用-M参数以后，找到第一对登录名或者密码的时候中止破解。
-t TASKS 同时运行的线程数，默认为16。
-W TIME 设置最大超时的时间，单位秒，默认是30s。
-V／-V显示详细过程。
-4/-6:use IPv4 (default)/IPv6 addresses (put always in [] also in -M)
server 目标ip
service指定服务名，支持的服务和协议

# example
hydra -1 user -P passlist.txt ftp://192.168.0.1 #ftp默认端口号为21，如需指定端口，可以使用-s参数，或者在ip地址后面加：端口，比如ftp：//192.168.0.1:21

hydra -L userlist.txt -p defautpw imap://192.168.0.1/PLAIN
hydra -C defaults.txt -6 pop3s://[2001:db8::1]:143/TLS:DIGEST-MD5 #defau1ts.txt中每一行数据的格式为用户名：密码，DIGEST-MD5认证机制是基于MD5算法的LINUX安全机制认证，现在的意思就是说，密码暴破的时候，按照LINUX的MD5算法来进行密码暴破

hydra -l admin -p password ftp://[192.168.0.0/24]/
hydra -L logins.txt -P pws.txt -M targets.txt ssh

# 爆破数据库
hydra -L user.txt -P top100.txt -vV mysql://172.25.37.222
```



# 靶场

### overwire

12:7x16WNeHIi5YkIhWsfFIqoognUTyj9Q4



### bwapp

```zsh
# 运行 -rm:结束后销毁容器 -d:后台运行 -p:指定端口
docker run -d -p 8000:80 crpi-5n15exszkwcopfim.cn-hangzhou.personal.cr.aliyuncs.com/andy171218/bwapp

# 登录
http://localhost:8000/install.php
http://localhost:8000/login.php
用户名:bee
密码:bug
# 构建数据库->完成

# 结束
docker stop ID
```



### pikachu

```zsh
# 运行 -rm:结束后销毁容器 -d:后台运行 -p:指定端口
docker run -d -p 8001:80 swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/area39/pikachu:latest

# 构建数据库->完成

# 结束
docker stop ID
```




### dvwa

```zsh
# 运行 -rm:结束后销毁容器 -d:后台运行 -p:指定端口
docker run -d -p 8002:80 swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io/sagikazarmark/dvwa:latest

# 登录
账号:admin
密码:password

# 构建数据库->完成

# 结束
docker stop ID
```



### webug

```zsh
# 运行 -rm:结束后销毁容器 -d:后台运行 -p:指定端口
docker run -d -p 8003:80 crpi-5n15exszkwcopfim.cn-hangzhou.personal.cr.aliyuncs.com/andy171218/webug

# 登录
账号:admin
密码:admin

# 构建数据库->完成

# 结束
docker stop ID
```



### Vulapps

```zsh
# 运行 -rm:结束后销毁容器 -d:后台运行 -p:指定端口
docker run -d -p 8004:80 medicean/vulapps:s_struts2_s2-037

# 结束
docker stop ID
```



**其他**

```zsh
SQLMap 是一款非常强大且广为人知的开源自动化 SQL注入
漏洞检测与利用工具
支持检测和利用包括布尔盲注、时间盲注、报错注入、联合查询注入等常见的SQL注入类型，可根据目标情况灵活运用不同的注入手法来获取数据库中的数据或者执行相关操作一旦发现存在SQL注入漏洞，它可以进一步获取数据库的诸多关键信息，例如数据库的类型、版本号、数据库中的表名、列名以及具体的数据内容，帮助安全测试人员全面了解目标数
据库的情况

“Getshell”通常是指在网络安全领域，攻击者通过各种手段获取目标服务器的命令执行权限或者可交互式的Shell环境攻击者一旦获取Shell权限，便可肆意操作服务器资源比如窃取敏感信息（如用户数据、数据库内容等）、篡改服务器上的网页文件、安装恶意程序进一步控制服务器，甚至利用该服务器作为跳板去攻击其他关联的网络目标等

Webshell 是一种网页脚本木马
它通过网页脚本（如ASP、PHP、JSP等）形式存在
可以在被攻击的服务器上执行命令
攻击者利用Web应用程序的漏洞（如文件上传漏洞、SQL 注入漏洞等）
将 Webshell 脚本上传到目标服务器
从而获得对服务器的一定控制权

哥斯拉
由国内知名黑客＂Beichen＂于19岁时所写
内置了3种Payload以及6种加密器，6种支持脚本后缀，20个内置插件
相比市面上的其他权限管理工具，哥斯拉集成了大量的后渗透插件
在功能更加强大与丰富的同时，还有高稳定性、支持低版本服务器等特点。
哥斯拉的出现，一举破除了众红队在静态查杀、流量通信等方面的困局。

冰蝎
基于Java开发的动态加密通信流量的客户端
在实战中，第一代webshell管理工具＂菜刀＂的流量
特征非常明显，很容易就被安全设备检测到
基于流量加密的webshell变得越来越多，＂冰蝎＂自
此诞生
由于通信流量被加密，传统的WAF、IDS 设备难以检
测，给威胁狩猎带来较大挑战
水蝎其最大特点就是对交互流量进行对称加密，且加
密密钥是由随机数函数动态生成

中国蚁剑
中国蚁剑是一款开源的跨平台的网站管理工具
其功能上类似于＂中国菜刀＂，但是功能比菜刀更加丰富
由Node.js开发，采用了Electron作为外壳
ES6作为前端代码编写语言
搭配Babel＆＆Webpack进行组件化构建编译
主要面向于合法授权的渗透测试安全人员
以及进行常规操作的网站管理员

Fscan是一款开源的、轻量级的网络资产扫描工具
由国内知名黑客＂shadow1ng影舞者＂开发
旨在帮助安全从业者、网络管理员
以及渗透测试人员等
快速、高效地收集目标网络中的各类基础信息
为后续的安全评估、漏洞探测以及网络防御等工作提供有
力的数据支撑

态势感知
态势感知设备是一种集成情报、规则、机器学习与行为特征等检测引擎
可精准识别挖矿、勒索、钓鱼、APT攻击与僵木蠕等网络威胁
并提供自动化处置建议，以实战促企业安全运营闭环

隧道代理：
隧道代理是通过在网络中构建一条虚拟的“隧道”来实现代理功能的机制
这条隧道能够将客户端发出的网络请求封装在特定的协议数据中进行传输
经过中间代理服务器的处理后，再将请求转发到目标服务器
目标服务器返回的响应也会按原路通过隧道回传到客户端
就好像数据在一条专属的通道（即隧道）里进行往返传递一样

反向代理：
FRP的核心功能是帮助处于内网环境中的设备（如服务器、计算机等）
能够突破网络限制
让外网的用户可以访问到内网中的服务或资源
其工作基于客户端 - 服务器（Client-Server）架构模式
主要由客户端（frpc）和服务器端（frps）两部分组成
服务器端（frps）通常部署在具有公网IP地址的服务器上
负责接收来自外网的连接请求，并将这些请求按照配置规则转发到对应
的内网客户端
客户端（frpc）则部署在内网中的目标设备上，它会主动和服务器端建
立连接向服务器端告知自身的服务信息以及对应的转发规则等
以便服务器端知晓如何将接收到的外网请求准确地转发到内网相应设备
上的指定服务端口

正向代理：
Neo-regeorg是一个基于Python编写的
用于正向代理和内网穿透工具
采用 socks5 协议
支持的脚本类型：aspx、ashx、jsp、jspx、php

提权
Windows里的最高权限为System，而不是Administrator
Linux里的最高权限为root
当然，如果要给Vista之后的系统权限进行排序的话，无疑
TrustedInstaller的权限是高于System的
但在实战中，多数情况下你都是一个低权限用户，这会导
致后续很多操作无法实现，所以这就需要＂提权＂
操作系统代码在开发过程中可能会出现各种逻辑错误、内
柳猫大品文临尚-口游析游柒娜
就可能成为提权的突破口。例如Windows 操作系统历史上
曾出现过的内核级漏洞，攻击者编写针对这些漏洞的利用
代码（Exploit Code），可以绕过系统原本的权限检查机
制，让恶意程序以更高权限运行，实现提权。

免杀
特征码免杀：杀毒软件通常会依据病毒、恶意程序等的特征码来进行识别检测
特征码是从恶意程序中提取出来的具有代表性的一段代码、字节序列等
如同人的指纹一样
特征码免杀就是通过修改恶意程序中已被杀毒软件识别的这些特征码部分
让杀毒软件无法基于原有的特征匹配机制检测到它

Cobalt Strike 是一款以团队协作形式
进行网络攻击模拟及渗透测试的平台
旨在帮助安全专业人员评估目标网络的安全性
发现潜在漏洞并验证防御机制的有效性
它集成了众多先进的功能模块
涵盖了从信息收集、漏洞利用到权限维持等整
个网络渗透流程中的多个环节

蜜罐
蜜罐是一种被设计用来吸引攻击者、捕获攻击行为信息的虚拟或真实的网络资源
它看似存在有价值的信息或系统漏洞，就像放置在网络环境中的“诱饵”
诱导攻击者对其发起攻击，进而收集攻击者的攻击手段、行为习惯、工具使用等相关信息
帮助安全人员更好地了解潜在的安全威胁，完善防御策略。
```

